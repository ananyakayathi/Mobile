<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Payment — PixelMobile</title>
<style>
  :root{--bg:#061322;--accent:#06b6d4;--muted:#9fb4c7;--radius:12px}
  body{margin:0;padding:18px;background:linear-gradient(180deg,#021425,#071a2b);color:#eaf6fb;font-family:Inter,system-ui,Roboto,Arial;}
  .wrap{max-width:420px;width:100%;margin:0 auto}
  header{display:flex;align-items:center;gap:12px;margin-bottom:12px}
  .logo{width:46px;height:46px;border-radius:10px;background:linear-gradient(135deg,var(--accent),#7c3aed);display:flex;align-items:center;justify-content:center;font-weight:700;color:#021124}
  h1{margin:0;font-size:18px}
  .card{background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);padding:14px;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,0.6)}
  .summary{display:flex;align-items:center;gap:12px;margin-bottom:12px}
  .summary img{width:68px;height:68px;border-radius:8px;object-fit:cover}
  .summary .meta{flex:1}
  .meta h4{margin:0;font-size:15px}
  .meta p{margin:6px 0 0;color:var(--muted);font-size:13px}
  form{display:flex;flex-direction:column;gap:8px}
  input{padding:10px;border-radius:10px;border:0;background:rgba(255,255,255,0.03);color:inherit}
  .row{display:flex;gap:8px}
  .row input{flex:1}
  .btn{border:0;padding:12px;border-radius:12px;font-weight:700;background:linear-gradient(90deg,var(--accent),#7c3aed);color:#021124;cursor:pointer;margin-top:6px}
  .muted{color:var(--muted);font-size:13px;text-align:center;margin-top:10px}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="logo">PM</div>
    <div>
      <h1>Payment</h1>
      <p style="margin:0;color:var(--muted);font-size:13px">Secure checkout (demo)</p>
    </div>
  </header>

  <div class="card" id="payCard">
    <div id="productSummary" class="summary" style="display:none">
      <img id="pimg" src="" alt="product">
      <div class="meta">
        <h4 id="pname"></h4>
        <p id="pprice" style="color:var(--accent)"></p>
      </div>
    </div>

    <form id="paymentForm" onsubmit="event.preventDefault(); payNow()">
      <label>Card number</label>
      <input id="card" type="text" inputmode="numeric" maxlength="19" placeholder="1234 5678 9012 3456" required>

      <div class="row">
        <div style="flex:1">
          <label>Expiry</label>
          <input id="expiry" type="text" placeholder="MM/YY" maxlength="5" required>
        </div>
        <div style="width:110px">
          <label>CVV</label>
          <input id="cvv" type="password" maxlength="4" placeholder="123" required>
        </div>
      </div>

      <button class="btn" type="submit">Proceed to Pay</button>
      <div class="muted">This is a demo form — no real transaction will occur.</div>
    </form>
  </div>
</div>

<script>
  // load product + buyer summary
  function load(){
    const raw = localStorage.getItem('selectedMobile');
    const form = localStorage.getItem('checkoutForm');
    if(!raw || !form){
      alert('Missing product or form details. Redirecting to shop.');
      location.href = 'index.html';
      return;
    }
    const p = JSON.parse(raw);
    document.getElementById('pimg').src = p.img;
    document.getElementById('pname').textContent = p.name;
    document.getElementById('pprice').textContent = '₹' + p.price.toLocaleString('en-IN');
    document.getElementById('productSummary').style.display = 'flex';
  }

  function sanitizeCard(v){
    return v.replace(/\D/g,'').slice(0,16).replace(/(.{4})/g,'$1 ').trim();
  }

  // small formatter for card input
  const cardEl = document.getElementById('card');
  const expiryEl = document.getElementById('expiry');
  document.addEventListener('input', e=>{
    if(e.target===cardEl){
      const pos = cardEl.selectionStart;
      const cleaned = sanitizeCard(cardEl.value);
      cardEl.value = cleaned;
    }
    if(e.target===expiryEl){
      let v = expiryEl.value.replace(/[^\d]/g,'').slice(0,4);
      if(v.length>2) v = v.slice(0,2) + '/' + v.slice(2);
      expiryEl.value = v;
    }
  });

  function payNow(){
    const card = cardEl.value.replace(/\s/g,'');
    const expiry = expiryEl.value;
    const cvv = document.getElementById('cvv').value;
    if(card.length < 12 || cvv.length < 3){
      alert('Please enter valid card details (demo validation).');
      return;
    }
    // store order summary
    const order = {
      id: 'order_' + Date.now().toString(36),
      product: JSON.parse(localStorage.getItem('selectedMobile')),
      buyer: JSON.parse(localStorage.getItem('checkoutForm')),
      paidAt: new Date().toISOString()
    };
    localStorage.setItem('lastOrder', JSON.stringify(order));
    // Clear sensitive-ish fields from storage (we never store card details)
    localStorage.removeItem('selectedMobile');
    // keep checkoutForm so thankyou can show buyer name
    setTimeout(()=> location.href = 'thankyou.html', 700);
  }

  // init
  load();
</script>
</body>
</html>
